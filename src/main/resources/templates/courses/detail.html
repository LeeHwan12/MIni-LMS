<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="ko">
<head>
    <meta charset="UTF-8" />
    <title th:text="${course.title} + ' - 강의 상세'">강의 상세</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <!-- 페이지 전용 보강 -->
    <style>
        .detail-header{display:flex;align-items:flex-start;gap:16px;justify-content:space-between;margin-bottom:16px}
        .title{font-size:24px;font-weight:800;color:#1F2C40}
        .badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
        .badge{display:inline-block;font-size:12px;padding:4px 8px;border-radius:999px;background:#EEF1F5;color:#1F2C40}
        .badge.status-open{background:#DFF5E4;color:#177245}
        .badge.status-closed{background:#E6E8EA;color:#495057}

        .meta{font-size:13px;color:#6A737D;margin-top:4px}
        .kvs{display:grid;grid-template-columns:140px 1fr;gap:8px;row-gap:10px;margin:16px 0 8px}
        .kvs .k{color:#6A737D}
        .kvs .v{color:#1F2C40}

        .desc{margin-top:8px;padding:16px;border:1px solid #E1E6EB;border-radius:12px;background:#fff;color:#4B5563;white-space:pre-line}
        .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:16px}

        .btn-secondary{background:#1F2C40;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer}
        .btn-secondary:hover{background:#162233}
        .btn-outline{background:#fff;color:#1F2C40;border:1px solid #1F2C40}
        .btn-outline:hover{color:#FF6B35;border-color:#FF6B35}
        .btn-danger{background:#c0392b}
        .btn-danger:hover{background:#a93226}
    </style>
</head>
<body>
<th:block th:replace="fragments/nav :: siteNav('홈')"></th:block>

<main>
    <!-- 헤더 -->
    <div class="detail-header">
        <div>
            <div class="title" th:text="${course.title}">강의 제목</div>
            <div class="badges">
                <span class="badge" th:text="${course.category}">BACKEND</span>
                <span class="badge"
                      th:classappend="${#strings.equalsIgnoreCase(course.status, 'open')} ? ' status-open' : ' status-closed'"
                      th:text="${#strings.equalsIgnoreCase(course.status,'open') ? 'open' : 'closed'}">open</span>
            </div>
            <div class="meta">
                생성일:
                <span th:text="${#temporals.format(course.createdAt, 'yyyy-MM-dd HH:mm')}">2025-09-12 10:00</span>
            </div>
        </div>

        <!-- 우측 액션 -->
        <div class="actions"
             th:if="${(#authentication?.name == course.createdBy)
              or #authorization.expression('hasRole(''ADMIN'')')}">
            <a th:href="@{|/courses/${course.courseId}/edit|}" class="btn-secondary"
               style="text-decoration:none;display:inline-block;line-height:1.6;padding:8px 16px;border-radius:6px;">수정</a>
        </div>
    </div>

    <!-- 기본 정보 Key-Value -->
    <div class="kvs">
        <div class="k">강사</div>
        <div class="v" th:text="${course.instructor}">홍길동</div>

        <div class="k">카테고리</div>
        <div class="v" th:text="${course.category}">BACKEND</div>

        <div class="k">상태</div>
        <div class="v">
      <span class="badge"
            th:classappend="${#strings.equalsIgnoreCase(course.status, 'open')} ? ' status-open' : ' status-closed'"
            th:text="${#strings.equalsIgnoreCase(course.status,'open') ? 'open' : 'closed'}">open</span>
        </div>
    </div>

    <!-- 설명 -->
    <div class="desc" th:text="${course.description}">강의 설명이 여기에 표시됩니다.</div>

    <!-- 상태 토글 액션 -->
    <div class="actions"
         th:if="${(#authentication?.name == course.createdBy)
              or #authorization.expression('hasRole(''ADMIN'')')}">
        <form method="post" th:action="@{|/courses/${course.courseId}/status|}">
            <input type="hidden" name="status"
                   th:value="${#strings.equalsIgnoreCase(course.status,'OPEN') ? 'closed' : 'open'}">
            <button type="submit"
                    th:text="${#strings.equalsIgnoreCase(course.status,'OPEN') ? '마감하기' : '오픈하기'}"
                    th:classappend="${#strings.equalsIgnoreCase(course.status,'OPEN') ? ' btn-danger' : ''}">
                마감하기
            </button>
        </form>
    </div>

    <div class="actions" style="justify-content:flex-start; gap:8px;">
        <!-- 강좌가 OPEN일 때만 신청/취소 버튼 노출 -->
        <th:block th:if="${courseOpen}">
            <form th:if="${enrolled != null and not enrolled}"
                  method="post" th:action="@{|/courses/${course.courseId}/enroll|}">
                <button type="submit">수강 신청</button>
            </form>

            <form th:if="${enrolled != null and enrolled}"
                  method="post" th:action="@{|/courses/${course.courseId}/unenroll|}">
                <button type="submit" class="btn-outline">신청 취소</button>
            </form>
        </th:block>

        <!-- CLOSED일 때 안내 -->
        <span th:if="${!#strings.equalsIgnoreCase(course.status,'open')}"
              style="color:#6A737D;font-size:14px">마감된 강좌입니다.</span>
    </div>
</main>

<th:block th:replace="fragments/footer :: siteFooter"></th:block>

</body>
</html>
